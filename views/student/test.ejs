<!DOCTYPE html>

<%
  if (!questions || questions.length === 0) {
    questions = [
      {
        question: "If the cost price is ‚Çπ400 and profit is 25%, find the selling price.",
        options: ["‚Çπ450", "‚Çπ480", "‚Çπ520", "‚Çπ500"],
        answer: 1
      }
    ];
  }
%>

    
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <header class="header">
        <nav class="navbar">
            <div class="nav-container">
                <div class="logo">
                    <h1>üéØ Aptitude Quest</h1>
                </div>
                <div class="nav-buttons">
                    <span style="margin-right: 1rem; color: #666;">Student: <%= student.roll_no %></span>
                </div>
            </div>
        </nav>
    </header>

    <main class="main-content">
        <div class="test-container">
            <div class="timer" id="timer">
                ‚è±Ô∏è Time Remaining: <span id="time">60:00</span>
            </div>

            <form id="testForm" action="/student/submit" method="POST">
                <% 
                const sections = [
                    { id: 'quantitative', title: 'Quantitative Aptitude' },
                    { id: 'logical', title: 'Logical Reasoning' },
                    { id: 'verbal', title: 'Verbal Ability' }
                ];
                %>

                <% sections.forEach(section => { %>
                    <div class="section-header-pill">
                        <%= section.title %>
                    </div>

                    <% 
                    const sectionQuestions = questions.filter(q => q.section === section.id);
                    let qCount = 1;
                    %>

                    <% if (sectionQuestions.length > 0) { %>
                        <% sectionQuestions.forEach(function(question) { %>
                            <div class="question-card">
                                <div class="question-title">Q.<%= qCount %>.</div>
                                <div class="question-text">
                                    <%= question.question %>
                                </div>
                                <div class="options-simple">
                                    <label class="option-simple">
                                        <input type="radio" name="q<%= question.id %>" value="a">
                                        <span class="option-letter">A</span>
                                        <span class="option-text"><%= question.option_a %></span>
                                    </label>
                                    <label class="option-simple">
                                        <input type="radio" name="q<%= question.id %>" value="b">
                                        <span class="option-letter">B</span>
                                        <span class="option-text"><%= question.option_b %></span>
                                    </label>
                                    <label class="option-simple">
                                        <input type="radio" name="q<%= question.id %>" value="c">
                                        <span class="option-letter">C</span>
                                        <span class="option-text"><%= question.option_c %></span>
                                    </label>
                                    <label class="option-simple">
                                        <input type="radio" name="q<%= question.id %>" value="d">
                                        <span class="option-letter">D</span>
                                        <span class="option-text"><%= question.option_d %></span>
                                    </label>
                                </div>
                            </div>
                            <% qCount++; %>
                        <% }); %>
                    <% } else { %>
                        <div class="no-questions-pill">No questions added yet for this section.</div>
                    <% } %>
                <% }); %>

                <div style="text-align: center; margin-top: 2rem; margin-bottom: 4rem;">
                    <button type="submit" class="submit-test">
                        Submit Test
                    </button>
                </div>
            </form>
        </div>
    </main>

    <script>
        // Timer functionality
        let timeLeft = 60 * 60; 
        const timerElement = document.getElementById('time');
        
        function updateTimer() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            timerElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            if (timeLeft <= 300) {
                document.getElementById('timer').style.background = '#ff4757';
            }
            
            if (timeLeft === 0) {
                document.getElementById('testForm').submit();
            }
            
            timeLeft--;
        }
        
        setInterval(updateTimer, 1000);
        updateTimer();

        // Auto-save answers
        document.querySelectorAll('input[type="radio"]').forEach(radio => {
            radio.addEventListener('change', () => {
                const formData = new FormData(document.getElementById('testForm'));
                const answers = {};
                for (let [key, value] of formData.entries()) {
                    answers[key] = value;
                }
                const rollNo = '<%= student.roll_no %>';
                localStorage.setItem('testAnswers_' + rollNo, JSON.stringify(answers));
            });
        });

        // Restore answers
        window.addEventListener('load', function() {
            const rollNo = '<%= student.roll_no %>';
            const savedAnswers = localStorage.getItem('testAnswers_' + rollNo);
            if (savedAnswers) {
                const answers = JSON.parse(savedAnswers);
                for (let [key, value] of Object.entries(answers)) {
                    const radio = document.querySelector(`input[name="${key}"][value="${value}"]`);
                    if (radio) radio.checked = true;
                }
            }
        });
    </script>

    <style>
        .section-header-pill {
            background: #6c5ce7;
            color: white;
            padding: 12px 30px;
            border-radius: 30px;
            display: inline-block;
            font-size: 1.2rem;
            font-weight: 600;
            margin: 2rem 0 1rem;
            box-shadow: 0 4px 15px rgba(108, 92, 231, 0.3);
        }

        .no-questions-pill {
            background: #f1f2f6;
            color: #747d8c;
            padding: 10px 20px;
            border-radius: 10px;
            margin-bottom: 1rem;
            font-style: italic;
        }

        .question-card {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .question-title {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: #2d3436;
        }

        .question-text {
            font-size: 1.1rem;
            margin-bottom: 1.5rem;
            color: #636e72;
        }

        .options-simple {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
        }

        .option-simple {
            display: flex;
            align-items: center;
            gap: 1rem;
            cursor: pointer;
            padding: 5px;
            border-radius: 5px;
            transition: background 0.2s;
        }

        .option-simple:hover {
            background: #f8f9fa;
        }

        .option-letter {
            font-weight: 700;
            font-size: 1.1rem;
            color: #2d3436;
            min-width: 20px;
        }

        .option-text {
            font-size: 1rem;
            color: #2d3436;
        }

        input[type="radio"] {
            width: 18px;
            height: 18px;
            accent-color: #6c5ce7;
        }

        .timer {
            position: sticky;
            top: 20px;
            z-index: 1000;
            background: #6c5ce7;
            color: white;
            padding: 10px 20px;
            border-radius: 10px;
            text-align: center;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: 1rem;
        }
    </style>

</body>
</html>
